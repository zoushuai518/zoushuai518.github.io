<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>PHP输入输出流 - Jekyll</title>
        <!-- meta -->
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
        <meta name="generator" content="Jekyll" />
        <meta name="author" content="邹帅" />
        <meta name="description" content="Just another Jekyll theme design and code by zous.me." />
        <meta name="keywords" content="" />
        <!-- atom -->
        <link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/atom.xml" />
        <link rel="shortcut icon" href="http://jekyllrb.com/favicon.png" type="image/x-icon" />
        <!-- font-awesome -->
        <link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">
        <link href='http://fonts.googleapis.com/css?family=Spirax' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="/assets/css/syntax.css">
        <link rel="stylesheet" href="/assets/css/main.css">
        
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-56893240-1', 'auto');
          ga('send', 'pageview');

        </script>
        
    </head>
    <body>
        <div class="head fn-clear">
            <div class="header">
                <h1 class="logo">
                    <a href=""><i class="icon-anchor"></i></a>
                </h1>
                <nav class="nav">
                    <ul>
                        
                        
                        
                        <li class="nav-item ">
                            <a href="/index.html">
                                首页
                            </a>
                            
                        </li>
                        
                        
                        
                        <li class="nav-item ">
                            <a href="/categories.html">
                                分类目录
                            </a>
                            
                        </li>
                        
                        
                        
                        <li class="nav-item ">
                            <a href="/archives.html">
                                文章归档
                            </a>
                            
                        </li>
                        
                        
                        
                        <li class="nav-item ">
                            <a href="/links.html">
                                友情链接
                            </a>
                            
                        </li>
                        
                    </ul>
                </nav>
                <div class="follow">
                    
                    <a href="/atom.xml" target="_blank"><i class="icon-rss"></i></a>
                    
                    <a href="http://weibo.com/luoyoo/home" target="_blank"><i class="icon-weibo"></i></a>
                    
                    <a href="https://github.com/zoushuai518" target="_blank"><i class="icon-github-alt"></i></a>
                    
                    <a href="https://twitter.com/zoushuai518" target="_blank"><i class="icon-twitter"></i></a>
                    
                </div>
            </div>
        </div>
        <div class="contain fn-clear">
            <div class="container fn-clear">
                <div class="main">
                    <div class="article article-post">
    <h2 class="title">PHP输入输出流</h2>
    <div class="info">
        <span class="info-title"><i class="icon-calendar"></i> Published: </span>
        <span class="info-date">26 Sep 2014</span>
        <span class="info-title"><i class="icon-folder-open"></i> Category: </span>
        <span class="info-link"><a href="/categories.html#php-ref" >php</a></span>
    </div>
    <ul>
<li>file<em>get</em>contents(&#39;php://input&#39;)</li>
</ul>

<p>PHP仅仅解析Content-Type为 application/x-www-form-urlencoded 或 multipart/form-data的Http请求。之所以这样是因为历史原因，PHP最初实现$_POST时，最流行的就是上面两种类型。因此虽说现在有些类型（比如application/json）很流行，但PHP中还是没有去实现自动处理。</p>

<p>因为POST是全局变量，所以更改<em>POST会全局有效。因此对于Content-Type为 application/json 的请求，我们需要手工去解析json数据，然后修改$</em>POST变量。</p>

<p>$<em>POST = json</em>decode(file<em>get</em>contents(&#39;php://input&#39;), true);
//此时，我们再去输出$_POST变量，则会得到我们期望的输出：</p>

<p>array(2) { [&quot;a&quot;]=&gt; string(1) &quot;a&quot; [&quot;b&quot;]=&gt; string(1) &quot;b&quot; }</p>

<p>-
php接收二进制文件转换成图片
$GLOBALS[&#39;HTTP<em>RAW</em>POST_DATA&#39;]</p>

<p>最近在做Flash在线裁剪图片 生成图片的东西。
通过Flash POST 图片的二进制数据给php，由php生成图片保存。</p>

<p>开始想到用$_POST来接受。后来发现行不通。
查阅了很多资料 明白了所以然，这里做一个笔记：</p>

<p>于PHP默认只识别application/x-www.form-urlencoded标准的数据类型。
因此，对型如text/xml 或者 soap 或者 application/octet-stream 之类的内容无法解析，如果用$<em>POST数组来接收就会失败！
故保留原型，交给$GLOBALS[&#39;HTTP</em>RAW<em>POST</em>DATA&#39;] 来接收。</p>

<p>另外还有一项 php://input 也可以实现此这个功能</p>

<p>php://input 允许读取 POST 的原始数据。和 $HTTP<em>RAW</em>POST<em>DATA 比起来，它给内存带来的压力较小，并且不需要任何特殊的 php.ini 设置。php://input和 $HTTP</em>RAW<em>POST</em>DATA 不能用于 enctype=&quot;multipart/form-data&quot;。</p>

<p>我在Flash中使用JPGEncoder把BitMapData转成二进制，然后post给php</p>

<p>php页面代码如下：</p>

<p>&lt;?php
$filename=&quot;teststream.jpg&quot;;//要生成的图片名字</p>

<p>$xmlstr =  $GLOBALS[HTTP<em>RAW</em>POST<em>DATA];
if(empty($xmlstr)) $xmlstr = file</em>get_contents(&#39;php://input&#39;);</p>

<p>$jpg = $xmlstr;//得到post过来的二进制原始数据
$file = fopen(&quot;cache/pic/&quot;.$filename,&quot;w&quot;);//打开文件准备写入
fwrite($file,$jpg);//写入
fclose($file);//关闭</p>

<p>?&gt;</p>

<p>-
&lt;?php
//生成图片
$imgDir = &#39;uploadImg/&#39;;
$filename=&quot;nissangcj&quot;.$mobile.&quot;.jpg&quot;;///要生成的图片名字</p>

<p>$xmlstr =  $GLOBALS[HTTP<em>RAW</em>POST<em>DATA];
if(empty($xmlstr)) {
    $xmlstr = file</em>get_contents(&#39;php://input&#39;);
}</p>

<p>$jpg = $xmlstr;//得到post过来的二进制原始数据
if(empty($jpg))
{
    echo &#39;nostream&#39;;
    exit();
}</p>

<p>$file = fopen(&quot;./&quot;.$imgDir.$filename,&quot;w&quot;);//打开文件准备写入
fwrite($file,$jpg);//写入
fclose($file);//关闭</p>

<p>$filePath = &#39;./&#39;.$imgDir.$filename;</p>

<p>//图片是否存在
if(!file_exists($filePath))
{
    echo &#39;createFail&#39;;
    exit();
}
?&gt;</p>

<p>-</p>

<p>首先这个代码的php文件就作为图片文件.
&lt;?php //设文件名为test.php
$data=file<em>get</em>contents(&quot;1.jpg&quot;);   //这里就是把图像读取成字符串了
$im = imagecreatefromstring($data); //这里主要检查上面的字符串  是否为图片的字符串
if ($im !== false) {
    header(&#39;Content-Type: image/jpeg&#39;); //对应jpeg的类型
    imagejpeg($im);////也要对应jpeg的类型
    imagedestroy($im);
}
else {
    echo &#39;图片未读入&#39;;
}</p>

<p>=========
然后再另一个html或php中写上<img src='test.php' />显示该图片
?&gt;</p>

<p>-</p>

<p>-
&lt;?php
header(&quot;Content-Type: image/jpeg&quot;);
$filename = time().&#39;.png&#39;;
$str = base64_decode($logo);
$fp = fopen($imgPath . $filename, &#39;w&#39;);
fwrite($fp, $str);
fclose($fp);
?&gt;</p>

<p>-</p>

<p>http://www.5idev.com/p-php<em>imagecreatefrom</em>gif<em>jpeg</em>png.shtml
http://php.net/manual/zh/function.imagecreatefromstring.php</p>

<p>2014-12-18 zs is not note</p>

    <nav class="article-previous fn-clear">
        
        <a class="prev" href="/php/2014/09/26/php-session%E5%85%B1%E4%BA%AB.html" rel="bookmark">&laquo;&nbsp;PHP session共享</a>
        
        
        <a class="next" href="/linux/2014/09/28/Docker.html" rel="bookmark">Docker&nbsp;&raquo;</a>
        
    </nav>
    <div class="comment">
        
        <div id="disqus_thread"></div>
        
    </div>
</div>

                </div>
                <div class="aside">
                    <div class="aside-contact">
                        <h4 class="title">About me</h4>
                        <div class="det fn-clear">
                            <div class="det-image">
                                <img src="https://avatars0.githubusercontent.com/u/5516045?v=3&s=460" />
                            </div>
                            <div class="det-text">
                                <p>我是「邹帅」，目前从事php开发！</p>
                            </div>
                        </div>
                    </div>

                    <div class="aside-item">
                        <h4 class="title">Recent Posts</h4>
                        <ul class="list">
                            
                                <li><a href="/php/2015/01/13/PHP%E7%9A%84%E8%BF%AD%E4%BB%A3%E5%99%A8.html" title="PHP迭代器" rel="bookmark">PHP迭代器</a></li>
                            
                                <li><a href="/php/2014/12/18/php-curl%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6.html" title="php curl 上传文件" rel="bookmark">php curl 上传文件</a></li>
                            
                                <li><a href="/mysql/2014/12/05/%E5%85%B3%E7%B3%BB%E9%9D%9E%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E9%80%89%E5%9E%8B.html" title="关系非关系型数据库选型" rel="bookmark">关系非关系型数据库选型</a></li>
                            
                                <li><a href="/php/2014/11/28/PHP-%E6%89%A7%E8%A1%8C%E7%B3%BB%E7%BB%9F%E5%A4%96%E9%83%A8%E5%91%BD%E4%BB%A4.html" title="PHP 执行系统外部命令 system() exec() passthru()" rel="bookmark">PHP 执行系统外部命令 system() exec() passthru()</a></li>
                            
                                <li><a href="/php/2014/11/28/PHP-xinc.html" title="PHP xinc持续集成服务器" rel="bookmark">PHP xinc持续集成服务器</a></li>
                            
                                <li><a href="/php/2014/11/28/PHP-phing.html" title="PHP 的 Phing 项目部署工具" rel="bookmark">PHP 的 Phing 项目部署工具</a></li>
                            
                        </ul>
                    </div>

                    <div class="aside-item">
                        <h4 class="title">Links</h4>
                        <ul class="list">
                            
                                
                                    
                                    <li><a href="http://zous.me" title="jz-code" target="_blank">jz-code</a></li>
                                    
                                    <li><a href="http://jekyllrb.com" title="Jekyll" target="_blank">Jekyll</a></li>
                                    
                                
                            
                                
                            
                        </ul>
                    </div>

                </div>
            </div>
        </div>
        <div class="foot">
            <div class="footer">
                <p>Copyright 2013. All rights reserved. Powered by <a href="http://jekyllrb.com" target="_blank">Jekyll</a>, Design by <a href="http://zous.me" target="_blank">zous.me</a>.</p>
            </div>
        </div>
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
        
            
            <script type="text/javascript">
                //disqus
                var disqus_shortname = 'codemadman';
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] ||
                        document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            
        
    </body>
</html>
